name: Telegram Push Notifier

on:
  push:
    branches: ["**"] # Trigger on all branches

jobs:
  notify:
    runs-on: ubuntu-latest
    steps:
      - name: Notify Telegram
        env:
          BOT_TOKEN: ${{ secrets.TELEGRAM_BOT_TOKEN }}
          CHAT_ID: ${{ secrets.TELEGRAM_CHAT_ID }}
        run: |
          COMMIT_MSG=$(echo '${{ github.event.head_commit.message }}' | sed -e 's/"/\\"/g' -e "s/'/\\'/g")

          curl -X POST \
            "https://api.telegram.org/bot${BOT_TOKEN}/sendMessage" \
            -H "Content-Type: application/json" \
            -d @- <<EOF
          {
            "chat_id": "${CHAT_ID}",
            "text": "ðŸš€ New Push to *${{ github.repository }}*\n\nâ–«ï¸ *Branch*: \`${{ github.ref_name }}\`\nâ–«ï¸ *Author*: ${{ github.actor }}\nâ–«ï¸ *Commit*: [${GITHUB_SHA:0:7}](https://github.com/${{ github.repository }}/commit/${{ github.sha }})\nâ–«ï¸ *Message*: ${COMMIT_MSG}\n\n[View Changes](https://github.com/${{ github.repository }}/compare/${GITHUB_SHA}~1...${GITHUB_SHA})",
            "parse_mode": "MarkdownV2",
            "disable_web_page_preview": true
          }
          EOF
